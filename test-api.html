<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LeanCloud API测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
        button { margin: 10px 0; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>LeanCloud API连接测试</h1>
    <div id="result">正在测试连接...</div>
    
    <h2>故障排除</h2>
    <div>
        <p>当前页面URL: <span id="current-url"></span></p>
        <p>当前页面协议: <span id="current-protocol"></span></p>
        <p>测试结果解释:</p>
        <ul>
            <li>如果看到 <code>错误信息: {"code":403,"error":"Access denied by api domain white list...."}</code>, 则表示:</li>
            <ul>
                <li>1. 您正在本地文件系统打开此页面（file://协议），导致没有Origin头</li>
                <li>2. 您的域名没有正确添加到LeanCloud的安全域名列表中</li>
            </ul>
        </ul>
    </div>

    <h2>LeanCloud配置检查清单</h2>
    <ul>
        <li>确保将 <code>https://ssvxin.github.io</code> 添加到LeanCloud安全域名（不是SSVXinin）</li>
        <li>确保将 <code>http://localhost:8000</code> 也添加到安全域名（用于本地测试）</li>
        <li>如果使用自定义域名，也需要添加</li>
    </ul>

    <button onclick="testConnection()">重新测试连接</button>

    <script>
    // LeanCloud配置
    const APP_ID = '2ZmC6sqLRb9RZu5esRlf0Rtg-gzGzoHsz';
    const APP_KEY = '4MOhNRmTw2JsXaJTTr2BzjLc';
    const API_BASE = 'https://2zmc6sql.lc-cn-n1-shared.com';
    const CLASS_NAME = 'AccessRecord';

    // 显示当前URL信息
    document.getElementById('current-url').textContent = window.location.href;
    document.getElementById('current-protocol').textContent = window.location.protocol;

    async function testConnection() {
        const resultElement = document.getElementById('result');
        resultElement.innerHTML = '正在测试连接...';
        
        try {
            const response = await fetch(`${API_BASE}/1.1/classes/${CLASS_NAME}?limit=1`, {
                headers: {
                    'X-LC-Id': APP_ID,
                    'X-LC-Key': APP_KEY
                }
            });

            if (response.ok) {
                const data = await response.json();
                resultElement.innerHTML = `
                    <p class="success">连接成功！</p>
                    <p>响应状态码: ${response.status}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } else {
                const errorText = await response.text();
                resultElement.innerHTML = `
                    <p class="error">连接失败！</p>
                    <p>响应状态码: ${response.status}</p>
                    <p>错误信息: <pre>${errorText}</pre></p>
                `;
            }
        } catch (error) {
            resultElement.innerHTML = `
                <p class="error">连接异常！</p>
                <p>错误信息: ${error.message}</p>
            `;
        }
    }

    // 页面加载时测试连接
    document.addEventListener('DOMContentLoaded', testConnection);
    </script>
</body>
</html> 
